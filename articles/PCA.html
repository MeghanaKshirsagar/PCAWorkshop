<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running Principal Component Analysus in R • PCAworkshop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running Principal Component Analysus in R">
<meta property="og:description" content="PCAworkshop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PCAworkshop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/COA.html">Running Correspondence Analysis in R</a>
    </li>
    <li>
      <a href="../articles/Intro.html">A short PCA vignette- Wine Example</a>
    </li>
    <li>
      <a href="../articles/PCA.html">Running Principal Component Analysus in R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aedin/PCAworkshop">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="PCA_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running Principal Component Analysus in R</h1>
                        <h4 class="author">Aedin Culhane</h4>
            
            <h4 class="date">July 15, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aedin/PCAworkshop/blob/master/vignettes/PCA.Rmd"><code>vignettes/PCA.Rmd</code></a></small>
      <div class="hidden name"><code>PCA.Rmd</code></div>

    </div>

    
    
<div id="necessary-r-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#necessary-r-libraries" class="anchor"></a>Necessary R libraries</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Install, if necessary, and load necessary libraries and set up R session</span>
<span class="co">#if (!requireNamespace("BiocManager", quietly = TRUE)) #install.packages("BiocManager")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ade4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">FactoMineR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">factoextra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)</pre></body></html></div>
</div>
<div id="pca-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#pca-in-r" class="anchor"></a>PCA in R</h1>
<p>In R, there are several functions in many different packages that allow us to perform PCA. We will not review all of these, however will provide examples of the following;</p>
<ul>
<li>svd() (stats) *** on centered data**</li>
<li>prcomp() (stats)</li>
<li>princomp() (stats) ** on cor matrix **</li>
<li>PCA() (FactoMineR)</li>
<li>dudi.pca() (ade4)</li>
</ul>
<p><strong>Note, although prcomp sets scale=FALSE for consistency with S, in general scaling is advised. We will demonstrate first pca of unscaled and then scaled data. Scaling scaled the variables to have unit variance and is advised before analysis takes place.</strong></p>
<p>We will demonstrate some of these and explore these using exploR</p>
</div>
<div id="equivalents-across-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#equivalents-across-methods" class="anchor"></a>Equivalents across methods</h1>
<p>Give an input matrix P and result res</p>
<table class="table">
<thead><tr class="header">
<th align="left">Function</th>
<th align="left">loadings</th>
<th align="left">scores</th>
<th align="left">plot</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">prcomp(P, center=TRUE, scale=TRUE)</td>
<td align="left">res$rotation</td>
<td align="left">res$x</td>
<td align="left">biplot(res)</td>
</tr>
<tr class="even">
<td align="left">princomp(P, cor=TRUE)</td>
<td align="left">res$loadings</td>
<td align="left">res$scores</td>
<td align="left">biplot(res)</td>
</tr>
<tr class="odd">
<td align="left">PCA(P)</td>
<td align="left">res$svd$V</td>
<td align="left">res$ind$coord</td>
<td align="left">plot(res)</td>
</tr>
<tr class="even">
<td align="left">dudi.pca(P, center=TRUE, scale=TRUE)</td>
<td align="left">res$c1</td>
<td align="left">res$li</td>
<td align="left">scatter(res)</td>
</tr>
</tbody>
</table>
<p>With ade4::dudi.pca and prcomp the default is center = TRUE, scale = TRUE.But with princomp, cor=FALSE by default.</p>
</div>
<div id="create-a-simple-toy-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#create-a-simple-toy-dataset" class="anchor"></a>Create a simple toy dataset</h1>
<p>Create a cloud of points; two vectors, x,y of length 100.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"> <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2</span>)             <span class="co">#sets the seed for random number generation.</span>
 <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fl">100</span>              <span class="co">#creates a vector x with numbers from 1 to 100</span>
 <span class="no">ex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">30</span>) <span class="co">#100 normally distributed random numbers, mean=0, sd=30</span>
 <span class="no">ey</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">30</span>) <span class="co"># 100 normally distributed random numbers, mean=0, sd=30</span>
 <span class="no">y</span> <span class="kw">&lt;-</span> <span class="fl">30</span> + <span class="fl">2</span> * <span class="no">x</span>         <span class="co">#sets y to be a vector that is a linear function of x</span>
 <span class="no">x_obs</span> <span class="kw">&lt;-</span> <span class="no">x</span> + <span class="no">ex</span>         <span class="co">#adds "noise" to x</span>
 <span class="no">y_obs</span> <span class="kw">&lt;-</span> <span class="no">y</span> + <span class="no">ey</span>         <span class="co">#adds "noise" to y</span>

<span class="co"># Bind both vectors in a matrix of toy data called P</span>
<span class="no">P</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x_obs</span><span class="kw">=</span><span class="no">x_obs</span>,<span class="kw">y_obs</span><span class="kw">=</span><span class="no">y_obs</span>) <span class="co">#places points in matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">P</span>)</pre></body></html></div>
<pre><code>     x_obs            y_obs       
 Min.   :-53.33   Min.   : 14.13  
 1st Qu.: 21.44   1st Qu.: 97.22  
 Median : 44.37   Median :134.91  
 Mean   : 49.58   Mean   :131.88  
 3rd Qu.: 77.91   3rd Qu.:174.29  
 Max.   :155.78   Max.   :252.63  </code></pre>
<p>Basic histogram of the two distrubition</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>))
 <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">P</span>$<span class="no">x_obs</span>)
 <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">P</span>$<span class="no">y_obs</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-2-1.png" width="1000"></p>
<p>Plot x,y. Show a “orange” point of the center (mean (x), mean(y)) on plot</p>
<p><code>{r}                                                                          plot(P,asp=1,col=1) #plot points points(x=mean(x_obs),y=mean(y_obs),col="orange", pch=19) #show center</code></p>
</div>
<div id="computing-via-svd-of-unscaled-centered-covariance-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#computing-via-svd-of-unscaled-centered-covariance-matrix" class="anchor"></a>Computing via svd of <strong>unscaled</strong>, centered, covariance matrix</h1>
<p>PCA can be computed as a singular value decomposition of a column centered matrix. Therefore we first processs the matrix. In this example, we don’t scale. This is not advised.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">#center matrix</span>
<span class="no">M</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">x_obs</span>-<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x_obs</span>),<span class="no">y_obs</span>-<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">y_obs</span>))
<span class="no">Mx</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>, <span class="kw">center</span><span class="kw">=</span><span class="fl">TRUE</span>,<span class="kw">scale</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p>M equal to Mx, ignore col names</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">M</span>, <span class="no">Mx</span>, <span class="kw">check.attributes</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>[1] TRUE</code></pre>
</div>
<div id="eigenvector-eigenvalues-of-the-centered-covariance-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#eigenvector-eigenvalues-of-the-centered-covariance-matrix" class="anchor"></a>Eigenvector, Eigenvalues of the centered, covariance matrix</h1>
<p>The eigenvectors of the covariance matrix provide the principal axes, and the eigenvalues quantify the fraction of variance explained in each component.</p>
<p>creates covariance matrix</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">MCov</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">M</span>)</pre></body></html></div>
<p>compute eigen values and vectors</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">eigenvalues</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span>(<span class="no">MCov</span>)$<span class="no">values</span>
<span class="no">eigenvalues</span></pre></body></html></div>
<pre><code>[1] 4110.45 1189.45</code></pre>
<p>(This is the same as prcomp PCA of the unscaled data)</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="no">P</span>)$<span class="no">sdev</span>^<span class="fl">2</span></pre></body></html></div>
<pre><code>[1] 4110.45 1189.45</code></pre>
<p>and similar to princomp</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/princomp.html">princomp</a></span>(<span class="no">P</span>)$<span class="no">sdev</span>^<span class="fl">2</span></pre></body></html></div>
<pre><code>  Comp.1   Comp.2 
4069.345 1177.556 </code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">eigenVectors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span>(<span class="no">MCov</span>)$<span class="no">vectors</span>
<span class="no">eigenVectors</span></pre></body></html></div>
<pre><code>          [,1]       [,2]
[1,] 0.4527354 -0.8916449
[2,] 0.8916449  0.4527354</code></pre>
<p>which is equivalent to</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="no">P</span>)$<span class="no">rotation</span></pre></body></html></div>
<pre><code>            PC1        PC2
x_obs 0.4527354 -0.8916449
y_obs 0.8916449  0.4527354</code></pre>
<p>The right singular vectors are the eigenvectors of M<sup>t</sup>M. Next I plot the principal axes (yellow):</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">P</span>,<span class="kw">asp</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">col</span><span class="kw">=</span><span class="fl">1</span>) <span class="co">#plot points</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x_obs</span>),<span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">y_obs</span>),<span class="kw">col</span><span class="kw">=</span><span class="st">"orange"</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">19</span>) <span class="co">#show center</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">x_obs</span>,<span class="no">eigenVectors</span>[<span class="fl">2</span>,<span class="fl">1</span>]/<span class="no">eigenVectors</span>[<span class="fl">1</span>,<span class="fl">1</span>]*<span class="no">M</span>[<span class="no">x</span>]+<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">y_obs</span>),<span class="kw">col</span><span class="kw">=</span><span class="fl">8</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-11-1.png" width="1000"></p>
<p>This shows the first principal axis. Note that it passes through the mean as expected. The ratio of the eigenvectors gives the slope of the axis.</p>
<p>Next plot the second principal axis, orthlogonal to the first</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">P</span>,<span class="kw">asp</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">col</span><span class="kw">=</span><span class="fl">1</span>) <span class="co">#plot points</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x_obs</span>),<span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">y_obs</span>),<span class="kw">col</span><span class="kw">=</span><span class="st">"orange"</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">19</span>) <span class="co">#show center</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">x_obs</span>,<span class="no">eigenVectors</span>[<span class="fl">2</span>,<span class="fl">1</span>]/<span class="no">eigenVectors</span>[<span class="fl">1</span>,<span class="fl">1</span>]*<span class="no">M</span>[<span class="no">x</span>]+<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">y_obs</span>),<span class="kw">col</span><span class="kw">=</span><span class="fl">8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">x_obs</span>,<span class="no">eigenVectors</span>[<span class="fl">2</span>,<span class="fl">2</span>]/<span class="no">eigenVectors</span>[<span class="fl">1</span>,<span class="fl">2</span>]*<span class="no">M</span>[<span class="no">x</span>]+<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">y_obs</span>),<span class="kw">col</span><span class="kw">=</span><span class="fl">8</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-12-1.png" width="1000"> shows the second principal axis, which is orthogonal to the first (recall that the matrix V<sup>t</sup> in the singular value decomposition is orthogonal). This can be checked by noting that the second principal axis is also</p>
<p>as the product of orthogonal slopes is -1.</p>
<div id="pca-scaled-data-using-singular-value-decomposition-svd" class="section level2">
<h2 class="hasAnchor">
<a href="#pca-scaled-data-using-singular-value-decomposition-svd" class="anchor"></a>PCA (scaled data) using Singular value decomposition (svd)</h2>
<p>Given a matrix X of dimension n×p, SVD decomposes it to:</p>
<p><span class="math inline">\(M = U D V^{t}\)</span></p>
<p>U,V define the left and right singular values</p>
<p>U and V are square orthogonal: <span class="math inline">\(UU^{t} = I_{p}\)</span> <span class="math inline">\(VV^{t} = I_{n}\)</span></p>
<p>The output is</p>
<p>d - a vector containing the singular values u - the left singular vectors v - the right singular vectors of x</p>
<p>Relating to prcomp;</p>
<p>The columns u from the SVD correspond to the principal components x in the PCA.</p>
<p>Furthermore, the matrix v from the SVD is equivalent to the rotation matrix returned by prcomp.</p>
<p>Now repeat the code above but <strong>scale</strong> and center the data scale(P, center=TRUE, scale=TRUE).</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="no">M</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>))  <span class="co">#FALSE</span></pre></body></html></div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>, <span class="kw">center</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">scale</span><span class="kw">=</span><span class="fl">TRUE</span>)<span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>)) <span class="co">#TRUE</span></pre></body></html></div>
<pre><code>[1] TRUE</code></pre>
<div id="scalep-centertrue-scaletrue" class="section level3">
<h3 class="hasAnchor">
<a href="#scalep-centertrue-scaletrue" class="anchor"></a>scale(P, center=TRUE, scale=TRUE)</h3>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">p0</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/svd.html">svd</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>))

<span class="no">p0</span>$<span class="no">d</span>          <span class="co">#the singular values</span></pre></body></html></div>
<pre><code>[1] 12.065827  7.239877</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">p0</span>$<span class="no">v</span>          <span class="co">#the right singular vectors</span></pre></body></html></div>
<pre><code>          [,1]       [,2]
[1,] 0.7071068 -0.7071068
[2,] 0.7071068  0.7071068</code></pre>
<p>The eigenvalues are</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">p0</span>$<span class="no">d</span>)</pre></body></html></div>
<pre><code>         [,1]     [,2]
[1,] 12.06583 0.000000
[2,]  0.00000 7.239877</code></pre>
<p>Which is</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">p0</span>$<span class="no">u</span>) <span class="kw">%*%</span> <span class="no">M</span> <span class="kw">%*%</span> <span class="no">p0</span>$<span class="no">v</span>)</pre></body></html></div>
<pre><code>[1] 612.6218 367.5924</code></pre>
<p>Eigenvalues from svd on the scaled data. The diagonal elements of d from the SVD are proportional to the standard deviations (sdev) returned by PCA.</p>
<p>The elements of d are formed by taking the sum of the squares of the principal components but not dividing by the sample size.</p>
<p>Therefore we can devide by the sample size, which is either the ncol or nrow of the matrix -1.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">p0</span>$<span class="no">d</span>^<span class="fl">2</span>/(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">p0</span>$<span class="no">u</span>) - <span class="fl">1</span>)</pre></body></html></div>
<pre><code>[1] 1.4705472 0.5294528</code></pre>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">eigenValues</span><span class="kw">=</span> <span class="no">p0</span>$<span class="no">d</span>^<span class="fl">2</span>/(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">p0</span>$<span class="no">u</span>) - <span class="fl">1</span>)
<span class="no">eigenValues</span></pre></body></html></div>
<pre><code>[1] 1.4705472 0.5294528</code></pre>
<p>Summary of eigs</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">eigSummary</span><span class="kw">&lt;-</span><span class="kw">function</span>(<span class="no">svdRes</span>,<span class="no">sf</span><span class="kw">=</span><span class="fl">4</span>){
  <span class="kw">if</span>(<span class="fu">is</span>(<span class="no">svdRes</span>,<span class="st">"prcomp"</span>)){
    <span class="no">eigenvalue</span><span class="kw">=</span><span class="no">svdRes</span>$<span class="no">sdev</span>^<span class="fl">2</span>
  }<span class="kw">else</span>{
  <span class="co">#d=signif(svdRes$d,sf)</span>
  <span class="no">eigenvalue</span><span class="kw">=</span> <span class="no">svdRes</span>$<span class="no">d</span>^<span class="fl">2</span>/(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">svdRes</span>$<span class="no">u</span>) - <span class="fl">1</span>)
}
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
  <span class="kw">eigenvalues</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span>(<span class="no">eigenvalue</span>,<span class="no">sf</span>),
  <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">eigenvalue</span>),<span class="no">sf</span>),
  <span class="kw">variance.percent</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span>((<span class="no">eigenvalue</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">eigenvalue</span>)),<span class="fl">2</span>)*<span class="fl">100</span>,<span class="st">"%"</span>),
  <span class="kw">cumulative.variance.percent</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span>((<span class="no">eigenvalue</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">eigenvalue</span>)),<span class="fl">2</span>))*<span class="fl">100</span>,<span class="st">"%"</span>)))
}


<span class="no">eigSum.svd</span> <span class="kw">&lt;-</span><span class="fu">eigSummary</span>(<span class="no">p0</span>)
<span class="no">eigSum.svd</span></pre></body></html></div>
<pre><code>  eigenvalues     sd variance.percent cumulative.variance.percent
1       1.471  1.213              74%                         74%
2      0.5295 0.7276              26%                        100%</code></pre>
</div>
</div>
<div id="demonstrating-x-u-d-v" class="section level2">
<h2 class="hasAnchor">
<a href="#demonstrating-x-u-d-v" class="anchor"></a>Demonstrating X = U D V’</h2>
<p>SVD returns a list with components</p>
<p>d = a vector containing the singular values of x, of length min(n, p), sorted decreasingly.</p>
<p>u = a matrix whose columns contain the left singular vectors of x, present if nu &gt; 0. Dimension c(n, nu).</p>
<p>v =a matrix whose columns contain the right singular vectors of x, present if nv &gt; 0. Dimension c(p, nv).</p>
<p>The product of these matrix X = U D V’ recovers the original matrix;</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r">(<span class="no">p0</span>$<span class="no">u</span> <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">p0</span>$<span class="no">d</span>) <span class="kw">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">p0</span>$<span class="no">v</span>))<span class="kw">%&gt;%</span> <span class="no">head</span></pre></body></html></div>
<pre><code>            [,1]       [,2]
[1,] -1.78511160 -1.1414577
[2,] -0.99401402 -1.5197211
[3,]  0.02497959 -1.7769963
[4,] -1.87979464 -1.9636443
[5,] -1.11114369 -1.9868817
[6,] -0.93661695 -0.4798394</code></pre>
<p>which equals the scaled matrix that was decomposed using svd</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>)<span class="kw">%&gt;%</span> <span class="no">head</span></pre></body></html></div>
<pre><code>           x_obs      y_obs
[1,] -1.78511160 -1.1414577
[2,] -0.99401402 -1.5197211
[3,]  0.02497959 -1.7769963
[4,] -1.87979464 -1.9636443
[5,] -1.11114369 -1.9868817
[6,] -0.93661695 -0.4798394</code></pre>
</div>
<div id="comparing-to-prcomp" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-to-prcomp" class="anchor"></a>Comparing to prcomp</h2>
<p>First stats::prcomp. The eigenvectors are stored in $rotation. Note these are the same as svd$v on scale data</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">p1</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="no">P</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">p1</span>$<span class="no">rotation</span></pre></body></html></div>
<pre><code>            PC1        PC2
x_obs 0.7071068 -0.7071068
y_obs 0.7071068  0.7071068</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"> (<span class="no">p1</span>$<span class="no">rotation</span><span class="kw">==</span> <span class="no">p0</span>$<span class="no">v</span>)</pre></body></html></div>
<pre><code>       PC1  PC2
x_obs TRUE TRUE
y_obs TRUE TRUE</code></pre>
<p>eigenvalues - sdev eigenvector - rotation</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">p1</span>)</pre></body></html></div>
<pre><code>[1] "sdev"     "rotation" "center"   "scale"    "x"       </code></pre>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">p1</span>)</pre></body></html></div>
<pre><code>Importance of components:
                          PC1    PC2
Standard deviation     1.2127 0.7276
Proportion of Variance 0.7353 0.2647
Cumulative Proportion  0.7353 1.0000</code></pre>
<p>To calculated eigenvalues information manually here is the code;</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">sf</span><span class="kw">=</span><span class="fl">4</span>
<span class="no">eigs</span><span class="kw">=</span> <span class="no">p1</span>$<span class="no">sdev</span>^<span class="fl">2</span>
<span class="no">eigSum.pca</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
  <span class="kw">eigenvalue</span><span class="kw">=</span><span class="no">eigs</span>,
  <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">eigs</span>),
  <span class="kw">variance.percent</span> <span class="kw">=</span> <span class="no">eigs</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">eigs</span>),
  <span class="kw">cumulative.variance.percent</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="no">eigs</span>)/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">eigs</span>))

<span class="no">eigSum.pca</span></pre></body></html></div>
<pre><code>     eigenvalue       sd variance.percent cumulative.variance.percent
[1,]  1.4705472 1.212661        0.7352736                   0.7352736
[2,]  0.5294528 0.727635        0.2647264                   1.0000000</code></pre>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">eigSum.svd</span>,<span class="no">eigSum.pca</span>)</pre></body></html></div>
<pre><code>[1] FALSE</code></pre>
<p>If we had more components, we could generate a scree plot. Its not very useful with 2 components, but here is the code</p>
<p>Caculate the Proportion of Variance explained by each component (eig sum Proportion above)</p>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="no">ProportionVariance</span> <span class="kw">=</span> <span class="no">p0</span>$<span class="no">d</span>^<span class="fl">2</span> /<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">p0</span>$<span class="no">d</span>^<span class="fl">2</span> )
<span class="no">ProportionVariance</span></pre></body></html></div>
<pre><code>[1] 0.7352736 0.2647264</code></pre>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ProportionVariance</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">5</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"b"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">16</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"principal components"</span>,
    <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"variance explained"</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-28-1.png" width="1000"></p>
</div>
</div>
<div id="princomp" class="section level1">
<h1 class="hasAnchor">
<a href="#princomp" class="anchor"></a>princomp</h1>
<p>princomp was written for compatiblity with S-PLUS however it is not recommended. Its is better to use prcomp or svd. That is because by default princomp performs a decompostion of the covariance not correlation matrix. Princomp can call eigen on the correlation or covariance matrix. Its default calculation uses divisor N for the covariance matrix.</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">p2</span><span class="kw">&lt;-</span><span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/princomp.html">princomp</a></span>(<span class="no">P</span>)
<span class="no">p2</span>$<span class="no">sd</span>^<span class="fl">2</span></pre></body></html></div>
<pre><code>  Comp.1   Comp.2 
4069.345 1177.556 </code></pre>
<p>sqrt of eigenvalues</p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">p2</span>$<span class="no">sdev</span></pre></body></html></div>
<pre><code>  Comp.1   Comp.2 
63.79142 34.31553 </code></pre>
<p>eigenvectors</p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="no">p2</span>$<span class="no">loadings</span></pre></body></html></div>
<pre><code>
Loadings:
      Comp.1 Comp.2
x_obs  0.453  0.892
y_obs  0.892 -0.453

               Comp.1 Comp.2
SS loadings       1.0    1.0
Proportion Var    0.5    0.5
Cumulative Var    0.5    1.0</code></pre>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">p2</span>$<span class="no">scores</span>,<span class="fl">2</span>)</pre></body></html></div>
<pre><code>        Comp.1     Comp.2
[1,] -94.48864 -36.682917
[2,] -99.33030   3.293649</code></pre>
<p>Set cor = TRUE in your call to princomp in order to perform PCA on the correlation matrix (instead of the covariance matrix)</p>
<div class="sourceCode" id="cb66"><html><body><pre class="r"><span class="no">p2b</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/princomp.html">princomp</a></span>(<span class="no">P</span>, <span class="kw">cor</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">p2b</span>$<span class="no">sdev</span>^<span class="fl">2</span></pre></body></html></div>
<pre><code>   Comp.1    Comp.2 
1.4705472 0.5294528 </code></pre>
<div class="sourceCode" id="cb68"><html><body><pre class="r"><span class="no">p2b</span>$<span class="no">loadings</span></pre></body></html></div>
<pre><code>
Loadings:
      Comp.1 Comp.2
x_obs  0.707  0.707
y_obs  0.707 -0.707

               Comp.1 Comp.2
SS loadings       1.0    1.0
Proportion Var    0.5    0.5
Cumulative Var    0.5    1.0</code></pre>
<p>For more info on prcomp v princomp see <a href="http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/118-principal-component-analysis-in-r-prcomp-vs-princomp/" class="uri">http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/118-principal-component-analysis-in-r-prcomp-vs-princomp/</a></p>
<div id="factominer" class="section level2">
<h2 class="hasAnchor">
<a href="#factominer" class="anchor"></a>FactoMineR</h2>
<p>FactoMineR::PCA calls svd to compute the PCA</p>
<div class="sourceCode" id="cb70"><html><body><pre class="r"><span class="no">p3</span><span class="kw">&lt;-</span><span class="kw pkg">FactoMineR</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/PCA.html">PCA</a></span>(<span class="no">P</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-35-1.png" width="1000"><img src="fig/unnamed-chunk-35-2.png" width="1000"></p>
<p>The eigenvalues, same as eigSum and eigSum.svd above</p>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">p3</span>$<span class="no">eig</span>)</pre></body></html></div>
<pre><code>                                     comp 1      comp 2
eigenvalue                         1.470547   0.5294528
percentage of variance            73.527362  26.4726382
cumulative percentage of variance 73.527362 100.0000000</code></pre>
</div>
</div>
<div id="correlations-between-variables-and-pcs" class="section level1">
<h1 class="hasAnchor">
<a href="#correlations-between-variables-and-pcs" class="anchor"></a>correlations between variables and PCs</h1>
<div class="sourceCode" id="cb73"><html><body><pre class="r"><span class="no">p3</span>$<span class="no">var</span>$<span class="no">coord</span></pre></body></html></div>
<pre><code>         Dim.1      Dim.2
x_obs 0.857481  0.5145157
y_obs 0.857481 -0.5145157</code></pre>
<div id="ade4dudi-pca" class="section level2">
<h2 class="hasAnchor">
<a href="#ade4dudi-pca" class="anchor"></a>ADE4::dudi.pca</h2>
<p>First ade4::dudi.pca scales the data and stores the scaled data in $tab. In PCA this will be almost equivalent to scale. However there is a minor difference (see <a href="https://pbil.univ-lyon1.fr/R/pdf/course2.pdf" class="uri">https://pbil.univ-lyon1.fr/R/pdf/course2.pdf</a>). ade4 usees the duality diagram framework for computing pca and other matrix factorizations (so it provides lw and cw which are the row and columns weights). See Cruz and Holmes 2011 for a wonderful tutorial on the duality diagram framework <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3265363/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3265363/</a></p>
<div class="sourceCode" id="cb75"><html><body><pre class="r"><span class="no">p4</span><span class="kw">&lt;-</span><span class="kw pkg">ade4</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ade4/man/dudi.pca.html">dudi.pca</a></span>(<span class="no">P</span>, <span class="kw">scannf</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">nf</span><span class="kw">=</span><span class="fl">2</span>)  <span class="co"># save 2 axis by default,</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">p4</span>$<span class="no">tab</span>)  <span class="co"># centered/scaled data. </span></pre></body></html></div>
<pre><code>        x_obs      y_obs
1 -1.79410466 -1.1472082
2 -0.99902168 -1.5273772
3  0.02510543 -1.7859484
4 -1.88926469 -1.9735368
5 -1.11674143 -1.9968913
6 -0.94133545 -0.4822568</code></pre>
<div class="sourceCode" id="cb77"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>))</pre></body></html></div>
<pre><code>           x_obs      y_obs
[1,] -1.78511160 -1.1414577
[2,] -0.99401402 -1.5197211
[3,]  0.02497959 -1.7769963
[4,] -1.87979464 -1.9636443
[5,] -1.11114369 -1.9868817
[6,] -0.93661695 -0.4798394</code></pre>
<p>The values used for centering are stored in cent, it is a the colMeans. norm provides the sd of the columns</p>
<div class="sourceCode" id="cb79"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">cent</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">P</span>)</pre></body></html></div>
<pre><code>x_obs y_obs 
 TRUE  TRUE </code></pre>
<div class="sourceCode" id="cb81"><html><body><pre class="r"><span class="no">sd.n</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * (<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>) - <span class="fl">1</span>)/<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>))
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">p4</span>$<span class="no">norm</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">P</span>, <span class="fl">2</span>, <span class="no">sd.n</span>))</pre></body></html></div>
<pre><code>[1] TRUE</code></pre>
<p>The summary printout is equivalent to P3 (p3<span class="math inline">\(eig) above. The eigenvales are stored in p4\)</span>eig.</p>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">p4</span>)</pre></body></html></div>
<pre><code>Class: pca dudi
Call: ade4::dudi.pca(df = P, scannf = FALSE, nf = 2)

Total inertia: 2

Eigenvalues:
    Ax1     Ax2 
 1.4705  0.5295 

Projected inertia (%):
    Ax1     Ax2 
  73.53   26.47 

Cumulative projected inertia (%):
    Ax1   Ax1:2 
  73.53  100.00 </code></pre>
<div class="sourceCode" id="cb85"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">eig</span></pre></body></html></div>
<pre><code>[1] 1.4705472 0.5294528</code></pre>
<div class="sourceCode" id="cb87"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">c1</span></pre></body></html></div>
<pre><code>            CS1        CS2
x_obs 0.7071068 -0.7071068
y_obs 0.7071068  0.7071068</code></pre>
<div class="sourceCode" id="cb89"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">co</span></pre></body></html></div>
<pre><code>         Comp1      Comp2
x_obs 0.857481 -0.5145157
y_obs 0.857481  0.5145157</code></pre>
<p>The cumulative % of variance explained by each component ;</p>
<div class="sourceCode" id="cb91"><html><body><pre class="r">(<span class="no">k</span> <span class="kw">&lt;-</span> <span class="fl">100</span> * <span class="no">p4</span>$<span class="no">eig</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">p4</span>$<span class="no">eig</span>))</pre></body></html></div>
<pre><code>[1] 73.52736 26.47264</code></pre>
<div class="sourceCode" id="cb93"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="no">k</span>)</pre></body></html></div>
<pre><code>[1]  73.52736 100.00000</code></pre>
<p>nf is an integer giving the number of axes kept. nf will always be lower that the number of row or columns of the matrix -1.</p>
<div class="sourceCode" id="cb95"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">nf</span></pre></body></html></div>
<pre><code>[1] 2</code></pre>
<p>c1 gives the variables’ coordinates, normed to 1. It is also called the coefficients of the combination or the loadings of variables. Equally the outpur matrix l1 gives the individuals’ coordinates, normed to 1. It is also called the loadings of individuals.</p>
<div class="sourceCode" id="cb97"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">c1</span></pre></body></html></div>
<pre><code>            CS1        CS2
x_obs 0.7071068 -0.7071068
y_obs 0.7071068  0.7071068</code></pre>
<div class="sourceCode" id="cb99"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">p4</span>$<span class="no">cw</span> * <span class="no">p4</span>$<span class="no">c1</span>$<span class="no">CS1</span>^<span class="fl">2</span>)</pre></body></html></div>
<pre><code>[1] 1</code></pre>
<p>co gives the variables’ coordinates, normed to the square root of the eigenvalues.</p>
<div class="sourceCode" id="cb101"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">co</span></pre></body></html></div>
<pre><code>         Comp1      Comp2
x_obs 0.857481 -0.5145157
y_obs 0.857481  0.5145157</code></pre>
<div class="sourceCode" id="cb103"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">p4</span>$<span class="no">cw</span> * <span class="no">p4</span>$<span class="no">co</span>$<span class="no">Comp1</span>^<span class="fl">2</span>)</pre></body></html></div>
<pre><code>[1] 1.470547</code></pre>
<p>The link between c1 and co is defined by:</p>
<div class="sourceCode" id="cb105"><html><body><pre class="r"><span class="no">p4</span>$<span class="no">c1</span>$<span class="no">CS1</span> * <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">p4</span>$<span class="no">eig</span>[<span class="fl">1</span>])</pre></body></html></div>
<pre><code>[1] 0.857481 0.857481</code></pre>
</div>
</div>
<div id="zscore-normalization" class="section level1">
<h1 class="hasAnchor">
<a href="#zscore-normalization" class="anchor"></a>Zscore normalization</h1>
<p>The default version of scale is a zscore standarization</p>
<div class="sourceCode" id="cb107"><html><body><pre class="r"><span class="no">zscore</span><span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) (<span class="no">x</span>-<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>))/<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">x</span>)
<span class="no">PZ</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">P</span>,<span class="fl">2</span>, <span class="no">zscore</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">PZ</span><span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="no">P</span>))</pre></body></html></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode" id="cb109"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">mean</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="no">PZ</span>)), <span class="kw">sd</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">PZ</span>,<span class="fl">2</span>, <span class="no">sd</span>))</pre></body></html></div>
<pre><code>      mean sd
x_obs    0  1
y_obs    0  1</code></pre>
<p>Then by extension, a P0, svd of a scaled matrix is the same as svd of a zscore matrix</p>
<div class="sourceCode" id="cb111"><html><body><pre class="r"><span class="no">pz</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/svd.html">svd</a></span>(<span class="no">PZ</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">pz</span>$<span class="no">v</span> <span class="kw">==</span> <span class="no">p0</span>$<span class="no">v</span>)</pre></body></html></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode" id="cb113"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">pzEigs</span><span class="kw">&lt;-</span><span class="no">pz</span>$<span class="no">d</span>^<span class="fl">2</span>/(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pz</span>$<span class="no">u</span>) - <span class="fl">1</span>) <span class="kw">==</span><span class="no">eigs</span>)</pre></body></html></div>
<pre><code>[1] FALSE</code></pre>
<div id="comparision-of-results-of-different-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#comparision-of-results-of-different-methods" class="anchor"></a>Comparision of results of different methods</h2>
<p>There is also a nice package called factoextra. This works all of the above classes</p>
<div class="sourceCode" id="cb115"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">factoextra</span>)

<span class="no">res</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">p0</span>,<span class="no">p1</span>,<span class="no">p2</span>,<span class="no">p2b</span>,<span class="no">p3</span>,<span class="no">p4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">res</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'svd_scaledData'</span>,<span class="st">'prcomp'</span>, <span class="st">'princomp'</span>,<span class="st">'princomp_cov'</span>, <span class="st">'FactoMineR'</span>, <span class="st">'ade4'</span>)

<span class="no">e</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">res</span>[-<span class="fl">1</span>],<span class="no">get_eig</span>)

<span class="co"># get_eig doesn't work on svd</span>
<span class="no">svd.e</span><span class="kw">&lt;-</span> <span class="no">eigSum.svd</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span>)]

<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">svd.e</span>)<span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">e</span><span class="kw">[[</span><span class="fl">1</span>]])


<span class="no">e</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">svd</span><span class="kw">=</span><span class="no">svd.e</span>),<span class="no">e</span>)

<span class="no">e</span></pre></body></html></div>
<pre><code>$svd
  eigenvalue variance.percent cumulative.variance.percent
1      1.471              74%                         74%
2     0.5295              26%                        100%

$prcomp
      eigenvalue variance.percent cumulative.variance.percent
Dim.1  1.4705472         73.52736                    73.52736
Dim.2  0.5294528         26.47264                   100.00000

$princomp
      eigenvalue variance.percent cumulative.variance.percent
Dim.1   4069.345         77.55712                    77.55712
Dim.2   1177.556         22.44288                   100.00000

$princomp_cov
      eigenvalue variance.percent cumulative.variance.percent
Dim.1  1.4705472         73.52736                    73.52736
Dim.2  0.5294528         26.47264                   100.00000

$FactoMineR
      eigenvalue variance.percent cumulative.variance.percent
Dim.1  1.4705472         73.52736                    73.52736
Dim.2  0.5294528         26.47264                   100.00000

$ade4
      eigenvalue variance.percent cumulative.variance.percent
Dim.1  1.4705472         73.52736                    73.52736
Dim.2  0.5294528         26.47264                   100.00000</code></pre>
</div>
</div>
<div id="visualization-and-exploration-of-results" class="section level1">
<h1 class="hasAnchor">
<a href="#visualization-and-exploration-of-results" class="anchor"></a>Visualization and Exploration of results</h1>
<p>The github package <a href="https://github.com/juba/explor" class="uri">https://github.com/juba/explor</a> is useful for exploring data. It includes plotting functions for many packages including ade4, FactoMineR and baseR functions prcomp and princomp;</p>
<p>For now on, it is usable the following types of analyses :</p>
<table class="table">
<colgroup>
<col width="29%">
<col width="29%">
<col width="22%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th>Analysis</th>
<th>Function</th>
<th>Package</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Principal Component Analysis</td>
<td>PCA</td>
<td><a href="http://factominer.free.fr/">FactoMineR</a></td>
<td>-</td>
</tr>
<tr class="even">
<td>Correspondance Analysis</td>
<td>CA</td>
<td><a href="http://factominer.free.fr/">FactoMineR</a></td>
<td>-</td>
</tr>
<tr class="odd">
<td>Multiple Correspondence Analysis</td>
<td>MCA</td>
<td><a href="http://factominer.free.fr/">FactoMineR</a></td>
<td>-</td>
</tr>
<tr class="even">
<td>Principal Component Analysis</td>
<td>dudi.pca</td>
<td><a href="https://cran.r-project.org/package=ade4">ade4</a></td>
<td>Qualitative supplementary variables are ignored</td>
</tr>
<tr class="odd">
<td>Correspondance Analysis</td>
<td>dudi.coa</td>
<td><a href="https://cran.r-project.org/package=ade4">ade4</a></td>
<td>-</td>
</tr>
<tr class="even">
<td>Multiple Correspondence Analysis</td>
<td>dudi.acm</td>
<td><a href="https://cran.r-project.org/package=ade4">ade4</a></td>
<td>Quantitative supplementary variables are ignored</td>
</tr>
<tr class="odd">
<td>Specific Multiple Correspondance Analysis</td>
<td>speMCA</td>
<td><a href="https://cran.r-project.org/package=GDAtools">GDAtools</a></td>
<td>Supplementary variables are not supported</td>
</tr>
<tr class="even">
<td>Multiple Correspondance Analysis</td>
<td>mca</td>
<td><a href="https://cran.r-project.org/package=MASS">MASS</a></td>
<td>Quantitative supplementary variables are not supported</td>
</tr>
<tr class="odd">
<td>Principal Component Analysis</td>
<td>princomp</td>
<td>stats</td>
<td>Supplementary variables are ignored</td>
</tr>
<tr class="even">
<td>Principal Component Analysis</td>
<td>prcomp</td>
<td>stats</td>
<td>Supplementary variables are ignored</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb117"><html><body><pre class="r">#if(!"explor" %in% rownames(installed.packages()))    #devtools::install_github("juba/explor")

#if(!"scatterD3" %in% rownames(installed.packages())) 
#devtools::install_github("juba/scatterD3")</pre></body></html></div>
<div class="sourceCode" id="cb118"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">explor</span>)
<span class="kw pkg">explor</span><span class="kw ns">::</span><span class="fu"><a href="https://juba.github.io/explor//reference/explor.html">explor</a></span>(<span class="no">p4</span>)</pre></body></html></div>
<div class="sourceCode" id="cb119"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">children</span>)
<span class="no">res.ca</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/CA.html">CA</a></span>(<span class="no">children</span>, <span class="kw">row.sup</span> <span class="kw">=</span> <span class="fl">15</span>:<span class="fl">18</span>, <span class="kw">col.sup</span> <span class="kw">=</span> <span class="fl">6</span>:<span class="fl">8</span>)
<span class="fu"><a href="https://juba.github.io/explor//reference/explor.html">explor</a></span>(<span class="no">res.ca</span>)</pre></body></html></div>
<div id="factoextra" class="section level2">
<h2 class="hasAnchor">
<a href="#factoextra" class="anchor"></a>factoextra</h2>
<p>Plotting using factoextra</p>
<div class="sourceCode" id="cb120"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">factoextra</span>)</pre></body></html></div>
<div class="sourceCode" id="cb121"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/eigenvalue.html">fviz_eig</a></span>(<span class="no">p1</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-53-1.png" width="1000"></p>
<div class="sourceCode" id="cb122"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca_var</a></span>(<span class="no">p1</span>,
             <span class="kw">col.var</span> <span class="kw">=</span> <span class="st">"contrib"</span>, <span class="co"># Color by contributions to the PC</span>
             <span class="kw">gradient.cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"#FC4E07"</span>),
             <span class="kw">repel</span> <span class="kw">=</span> <span class="fl">TRUE</span>     <span class="co"># Avoid text overlapping</span>
             )</pre></body></html></div>
<p><img src="fig/unnamed-chunk-54-1.png" width="1000"></p>
<div class="sourceCode" id="cb123"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca_biplot</a></span>(<span class="no">p1</span>, <span class="kw">repel</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                <span class="kw">col.var</span> <span class="kw">=</span> <span class="st">"#2E9FDF"</span>, <span class="co"># Variables color</span>
                <span class="kw">col.ind</span> <span class="kw">=</span> <span class="st">"#696969"</span>  <span class="co"># Individuals color</span>
                )</pre></body></html></div>
<p><img src="fig/unnamed-chunk-55-1.png" width="1000"></p>
</div>
</div>
<div id="drawing-ellispe" class="section level1">
<h1 class="hasAnchor">
<a href="#drawing-ellispe" class="anchor"></a>Drawing Ellispe</h1>
<p>Example using iris dataset</p>
<div class="sourceCode" id="cb124"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">iris</span>)
<span class="no">ir.pca</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">iris</span>[,<span class="fl">1</span>:<span class="fl">4</span>]), <span class="kw">center</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">scale</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p>Easiest approach:</p>
<div class="sourceCode" id="cb125"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggfortify</span>)
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">ir.pca</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">iris</span>, <span class="kw">colour</span><span class="kw">=</span><span class="st">"Species"</span>, <span class="kw">frame</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">frame.type</span><span class="kw">=</span><span class="st">"t"</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-57-1.png" width="1000"></p>
<div class="sourceCode" id="cb126"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">ir.pca</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">PC1</span>, <span class="no">PC2</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">alpha</span><span class="kw">=</span><span class="no">..level..</span>, <span class="kw">fill</span><span class="kw">=</span><span class="no">iris</span>$<span class="no">Species</span>), <span class="kw">bins</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">geom</span><span class="kw">=</span><span class="st">"polygon"</span>)</pre></body></html></div>
<p><img src="fig/unnamed-chunk-58-1.png" width="1000"></p>
<p>stat_ellipse() and stat_density_2d() have a lot of options. See manual pages</p>
<p>multivariate normal distribution.</p>
<pre><code><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse(type = "norm", linetype = 2)  </a></code></pre>
<p>Euclid, is a circle with radius = level</p>
<pre><code><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse(type = "euclid", level = 3) </a></code></pre>
<p>multivariate t-distribution</p>
<pre><code><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse(type = "t") </a></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aedin Culhane.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
